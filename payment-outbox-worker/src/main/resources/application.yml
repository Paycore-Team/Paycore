server:
  port: ${SERVER_PORT:9081}

spring:
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: 5672
    username: ${RABBITMQ_USERNAME:guest}
    password: ${RABBITMQ_PASSWORD:guest}
    virtual-host: /
    connection-timeout: 5s
    publisher-confirm-type: correlated
    publisher-returns: true

  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5434/paymentdb}
    username: ${SPRING_DATASOURCE_USERNAME:paymentuser}
    password: ${SPRING_DATASOURCE_PASSWORD:paymentpass}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: ${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
    properties:
      hibernate:
        dialect: ${SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT:org.hibernate.dialect.PostgreSQLDialect}
    show-sql: true
    open-in-view: false

# ================================
# üî• Actuator + Prometheus ÏÑ§Ï†ï Ï∂îÍ∞Ä
# ================================
management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always
  metrics:
    tags:
      application: payment-outbox-worker
  prometheus:
    enabled: true

# ================================
# Debezium ÏÑ§Ï†ï (ÏõêÎûò ÏûàÎçò Í≤É)
# ================================
debezium:
  payloadFormat: JSON
  offsetCommitPolicy: DEFAULT

  properties:
    name: payment-worker-connector
    connector.class: io.debezium.connector.postgresql.PostgresConnector

    database.hostname: payment-postgres
    database.port: 5432
    database.user: ${SPRING_DATASOURCE_USERNAME:paymentuser}
    database.password: ${SPRING_DATASOURCE_PASSWORD:paymentpass}
    database.dbname: paymentdb

    plugin.name: pgoutput

    topic.prefix: paymentdb

    slot.name: replication_slot
    publication.name: publication1
    publication.autocreate.mode: filtered
    table.include.list: public.payment_outbox

    offset.storage: org.apache.kafka.connect.storage.FileOffsetBackingStore
    offset.storage.file.filename: /etc/debezium/offsets.dat
    offset.flush.interval.ms: 6000

    schema.history.internal: io.debezium.relational.history.FileSchemaHistory
    schema.history.internal.file.filename: /etc/debezium/schema_history.dat

    snapshot.mode: initial

    decimal:
      handling:
        mode: string
