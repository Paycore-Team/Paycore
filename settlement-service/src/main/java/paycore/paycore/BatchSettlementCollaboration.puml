@startuml
skinparam linetype ortho
skinparam nodesep 200
skinparam ranksep 120
skinparam objectBackgroundColor #E8F4F8

title Batch Settlement Processing Collaboration

' Layer 1: Scheduler
object scheduler as "scheduler"

' Layer 2: Spring Batch
object jobLauncher as "JobLauncher"

' Layer 3: Tasklet
object tasklet as "tasklet"

' Layer 4: Repository
object repo as "repo"
object outboxRepo as "outboxRepo"

' Layer 5: Entity
object settlement as "settlement"
object outbox as "outbox"

' ============================================
' Step 1: Start Batch Job
' ============================================
scheduler -down-> jobLauncher : "1: run"
jobLauncher -down-> tasklet : "2: execute"

' ============================================
' Step 2: Query Pending Settlements
' ============================================
tasklet -down-> repo : "3: findAllByStatus"
repo -up-> tasklet : "4: List"

' ============================================
' Step 3: Process Each Settlement
' ============================================
tasklet -down-> settlement : "5: calculate"
tasklet -down-> settlement : "6: markCompleted"
tasklet -down-> repo : "7: save"
tasklet -down-> outbox : "8: create"
tasklet -down-> outboxRepo : "9: save"

' ============================================
' Step 4: Complete Batch Job
' ============================================
tasklet -up-> jobLauncher : "10: FINISHED"

@enduml

